<%*
// 快捷键触发：Control+Shift+K
// 简化版本 - 兼容性更好
// 作者：考现学观察者
// 版本：1.2-lite

// 1. 获取文件名
const fileName = await tp.system.prompt("请输入文件名：");
if (!fileName) {
  new Notice("文件名不能为空！");
  throw new Error("文件名不能为空");
}

// 生成日期前缀和完整文件名
const datePrefix = tp.date.now("YYYY-MM-DD");
const fullFileName = `${datePrefix} ${fileName}.md`;

// 2. 收集信息
const weather = await tp.system.prompt("今天天气如何？", "晴朗");
const tagsInput = await tp.system.prompt("请输入标签（用顿号分隔）：", "考现学");
const tags = tagsInput.split("、").map(tag => tag.trim()).filter(tag => tag);
const flash = await tp.system.prompt("今日灵光闪现（直接回车跳过）：", "");
const hasFlash = flash && flash.trim() !== "";

// 3. 收集考现笔记
const observations = [];
let observationIndex = 1;

new Notice("开始记录考现笔记（直接回车结束）");

while (true) {
  const observation = await tp.system.prompt(`考现笔记 ${observationIndex}（直接回车结束）：`);
  if (!observation || observation.trim() === "") {
    break;
  }
  observations.push(observation);
  observationIndex++;
}

const observer = await tp.system.prompt("调查者姓名：", "观察者");

// 4. 生成时间信息
const now = new Date();
const fullDateTime = tp.date.now("YYYY年MM月DD日 HH:mm:ss");
const weekDay = now.toLocaleDateString('zh-CN', { weekday: 'long' });
const tagList = tags.map(tag => `"${tag}"`).join(", ");

// 5. 生成内容
tR += `---
title: "${fileName}"
date: "${datePrefix}"
weather: "${weather}"
tags: [${tagList}]
observer: "${observer}"
created_time: "${fullDateTime}"
week_day: "${weekDay}"
observation_count: ${observations.length}
has_flash: ${hasFlash}
images:
  - "/images/observations/${datePrefix}-${fileName}-1.jpg"
  - "/images/observations/${datePrefix}-${fileName}-2.jpg"
---

# ${fileName}

## 📅 观察信息

- **观察日期**：${datePrefix}
- **观察时间**：${fullDateTime}
- **星期**：${weekDay}
- **天气**：${weather}
- **观察者**：${observer}
- **观察条数**：${observations.length}条

`;

// 灵光闪现
if (hasFlash) {
  tR += `## 💡 今日灵光闪现

> ${flash}

`;
}

// 考现笔记
if (observations.length > 0) {
  tR += `## 👀 考现笔记记录

`;
  observations.forEach((obs, index) => {
    tR += `### ${index + 1}. ${obs}

`;
  });
} else {
  tR += `## 👀 考现笔记记录

> 本次观察暂无具体记录内容

`;
}

tR += `## 🎯 观察分析

### 后续计划
- [ ] 深入观察相关现象
- [ ] 记录更多细节信息
- [ ] 分析背后的原因和影响

## 📸 图片建议

请将图片保存到：\`images/observations/${datePrefix}-${fileName}-1.jpg\`

---

**标签**：${tags.join("、")}  
*创建时间：${fullDateTime}*  

---
> 📌 文件创建后请手动移动到 content/observations/ 目录以便网站识别`;
%>